<?xml version="1.0"?>
<!--
////////////////////////////////////////////////////////////////////////////////
// Copyright 2015 Michael Schmalle - Teoti Graphix, LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License
//
// Author: Michael Schmalle, Principal Architect
// mschmalle at teotigraphix dot com
////////////////////////////////////////////////////////////////////////////////
-->
<mixer:MixerItemSkinBase xmlns:fx="http://ns.adobe.com/mxml/2009"
                         xmlns:f="library://ns.feathersui.com/mxml"
                         xmlns:ui="com.teotigraphix.ui.component.*"
                         xmlns:component="com.teotigraphix.ui.component.*"
                         xmlns:mixer="touch4bitwig.ui.component.mixer.*">

    <mixer:layout>
        <f:VerticalLayout gap="10" paddingTop="6" horizontalAlign="center"/>
    </mixer:layout>

    <!--  -->
    <ui:UIBorder color="{trackColor}" minHeight="20"
                 touch="child_touchHandler(event)">
        <ui:layoutData>
            <f:VerticalLayoutData percentWidth="100"/>
        </ui:layoutData>
    </ui:UIBorder>

    <!--=====================================================================-->
    <!-- Icon, Name -->
    <!--=====================================================================-->

    <component:HGroup percentWidth="100" gap="5" paddingLeft="5" paddingRight="5">

        <!-- Can hold notes stack -->
        <f:LayoutGroup>
            <f:ImageLoader id="noteIcon" visible="false"
                           source="{AssetMap.getTexture('hold-notes-icon-skin')}"
                           width="18" height="18"/>
            <f:ImageLoader id="audioIcon"
                           source="{AssetMap.getTexture('hold-audio-icon-skin')}"
                           width="18" height="18"/>
        </f:LayoutGroup>

        <!--  -->
        <f:Label id="nameLabel"
                 text="{trackName}"
                 styleName="{StyleNames.MIXER_ITEM_NAME_LABEL}">
            <f:layoutData>
                <f:HorizontalLayoutData percentWidth="100"/>
            </f:layoutData>
        </f:Label>

    </component:HGroup>

    <!--=====================================================================-->
    <!-- Pan Label/Slider -->
    <!--=====================================================================-->

    <component:VGroup percentWidth="100" padding="5" gap="5" horizontalAlign="center">

        <f:Label text="{panString}"/>

        <ui:UISlider id="panSlider"
                     styleName="{StyleNames.MIXER_ITEM_PAN_SLIDER}"
                     direction="horizontal" minimum="0" maximum="127" step="1"
                     change="pan_changeHandler(panSlider.value)">
            <ui:layoutData>
                <f:VerticalLayoutData percentWidth="100"/>
            </ui:layoutData>
        </ui:UISlider>

    </component:VGroup>


    <!--=====================================================================-->
    <!-- Volume Label -->
    <!--=====================================================================-->

    <component:HGroup percentWidth="100" horizontalAlign="center">

        <f:Label text="{volumeString}" styleName="{StyleNames.MIXER_ITEM_VOLUME_LABEL}"/>

    </component:HGroup>


    <!--=====================================================================-->
    <!-- RecArm, Solo, Mute | Volume -->
    <!--=====================================================================-->

    <component:HGroup percentWidth="100" percentHeight="100" padding="5" gap="5" verticalAlign="bottom">

        <component:VGroup gap="4">
            <ui:UIToggleButton id="recarmButton" label="O" isToggle="true"
                               styleName="{StyleNames.MIXER_ITEM_RECARM_BUTTON}"
                               change="recarm_changeHandler(recarmButton.isSelected)"/>

            <ui:UIToggleButton id="soloButton" label="S" isToggle="true"
                               change="solo_changeHandler(soloButton.isSelected)"
                               styleName="{StyleNames.MIXER_ITEM_SOLO_BUTTON}"/>

            <ui:UIToggleButton id="muteButton" label="M" isToggle="true"
                               styleName="{StyleNames.MIXER_ITEM_MUTE_BUTTON}"
                               change="mute_changeHandler(muteButton.isSelected)"/>
        </component:VGroup>

        <component:HGroup backgroundSkin="{AssetMap.create9ScaleImage('background-skin', 5, 5, 22, 22)}"
                          percentWidth="100" percentHeight="100" padding="5" gap="4">

            <f:ProgressBar value="{vu}"
                           styleName="{StyleNames.MIXER_ITEM_VU_BAR}">
                <f:layoutData>
                    <f:HorizontalLayoutData percentHeight="100"/>
                </f:layoutData>
            </f:ProgressBar>

            <ui:UISlider id="volumeSlider"
                         styleName="{StyleNames.MIXER_ITEM_VOLUME_SLIDER}"
                         change="volume_changeHandler(volumeSlider.value)">
                <ui:layoutData>
                    <f:HorizontalLayoutData percentWidth="100" percentHeight="100"/>
                </ui:layoutData>
            </ui:UISlider>

        </component:HGroup>


    </component:HGroup>

    <fx:Script><![CDATA[
        import com.teotigraphix.ui.theme.AssetMap;

        import starling.events.Touch;
        import starling.events.TouchPhase;

        import touch4bitwig.theme.StyleNames;

        override public function set canHoldNotes(value:Boolean):void
        {
            super.canHoldNotes = value;
            noteIcon.visible = value;
            audioIcon.visible = !value;
        }

        override public function set isRecArm(value:Boolean):void
        {
            super.isRecArm = value;
            recarmButton.setIsSelected(value);
        }

        override public function set isSolo(value:Boolean):void
        {
            super.isSolo = value;
            soloButton.setIsSelected(value);
        }

        override public function set isMute(value:Boolean):void
        {
            super.isMute = value;
            muteButton.setIsSelected(value);
        }

        override public function set pan(value:Number):void
        {
            super.pan = value;
            panSlider.setValue(value);
        }

        override public function set volume(value:Number):void
        {
            super.volume = value;
            volumeSlider.setValue(value);
        }

        private function child_touchHandler(event:starling.events.TouchEvent):void
        {
            var touch:Touch = event.getTouch(this, TouchPhase.BEGAN);
            if (touch != null)
            {
                dispatchEventWith(MixerItem.EVENT_SELECT, true);
            }
        }
        ]]></fx:Script>

</mixer:MixerItemSkinBase>
